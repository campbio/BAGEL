---
title: "BAGEL_vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{BAGEL_vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---




```r
library(MotifSig)
```


```r
#Load MAF File
#maf_file="/Users/atgc/Documents/Aaron_Tools/MotifSig/MotifSig/validation/mafs/TCGA.LUAD.muse.6f5cde97-d259-414f-8122-6d0d66f49b74.DR-10.0.somatic.maf"

maf_file="/Users/atgc/Documents/Aaron_Tools/MotifSig/MotifSig/inst/testdata/TCGA_test.maf"
maf = MotifSig::maf_to_dt(maf_file = maf_file)
#> -Reading
#> -Validating
#> -Silent variants: 96 
#> -Summarizing
#> --Possible FLAGS among top ten genes:
#>   MACF1
#> -Processing clinical data
#> --Missing clinical data
#> -Finished in 0.064s elapsed (0.062s cpu)

#Load VCF Files
#dir="/Users/atgc/Documents/Aaron_Tools/MotifSig/MotifSig/validation/vcfs/"
#vcfs=list.files(dir, all.files = TRUE, include.dirs = FALSE, pattern = "*.vcf", full.names = TRUE)

vcfs=list.files("/Users/atgc/Documents/Aaron_Tools/MotifSig/MotifSig/inst/testdata/", all.files=TRUE, pattern = "*.vcf", full.names = TRUE)
vcf = MotifSig::vcfs_to_dt(vcfs = vcfs)

vcf_mat <- rbind(maf, vcf)
dat <- vcf_mat

#Choose genome build
#Automatically detect genome build
#g=MotifSig::select_genome("38")

#Create Object and add samples
bagel = new("bagel")
#Can take samples
MotifSig::set_samples(bagel, dat)
MotifSig::sample_names(bagel)
#> [1] TCGA-35-4122-01A-01D-1105-08 TCGA_test1.vcf              
#> [3] TCGA_test2.vcf               TCGA_test3.vcf              
#> [5] TCGA_test4.vcf               TCGA_test5.vcf              
#> [7] TCGA_test6.vcf               TCGA_test7.vcf              
#> [9] TCGA_test8.vcf              
#> 9 Levels: TCGA-35-4122-01A-01D-1105-08 TCGA_test1.vcf ... TCGA_test8.vcf

#Or alternatively create an object with sample names included
bagel = new("bagel", samples = dat)
MotifSig::sample_names(bagel)
#> [1] TCGA-35-4122-01A-01D-1105-08 TCGA_test1.vcf              
#> [3] TCGA_test2.vcf               TCGA_test3.vcf              
#> [5] TCGA_test4.vcf               TCGA_test5.vcf              
#> [7] TCGA_test6.vcf               TCGA_test7.vcf              
#> [9] TCGA_test8.vcf              
#> 9 Levels: TCGA-35-4122-01A-01D-1105-08 TCGA_test1.vcf ... TCGA_test8.vcf

#Create 96 Motif samples
#g=MotifSig::select_genome("19")
#MotifSig::create_tables(bagel, g)
g=MotifSig::select_genome("38")
MotifSig::create_tables(bagel, g)

#Generate signatures/weights
#We can use the bagel object we generated tables for
result=MotifSig::find_signatures(bagel, num_signatures = 4)
#Or simply tables from any source
#result=MotifSig::find_signatures(bagel@prop_table, num_signatures = 4)

#Plot results
MotifSig::plot_signatures(result)
```

![plot of chunk unnamed-chunk-2](figure/unnamed-chunk-2-1.png)

```r
MotifSig::plot_samples(result, proportional = TRUE)
```

![plot of chunk unnamed-chunk-2](figure/unnamed-chunk-2-2.png)

```r
#TODO Should be counts
MotifSig::plot_samples(result, proportional = FALSE)
```

![plot of chunk unnamed-chunk-2](figure/unnamed-chunk-2-3.png)

```r

#Compare to COSMIC signatures by leaving the second result as default
MotifSig::compare_results(result, threshold = 0.75)
```

![plot of chunk unnamed-chunk-2](figure/unnamed-chunk-2-4.png)

```
#>         cor xindex yindex        xcol        ycol
#> 1 0.8465479      4      4 Signature.4 Signature.4

#List which signatures correspond to subtypes including "lung"
MotifSig::what_sigs("lung")
#> [1] "lung adeno"
#> [1]  1  2  4  5  6 13 17
#> [1] "lung  small cell"
#> [1]  1  4  5 15
#> [1] "lung  squamous"
#> [1]  1  2  4  5 13
#what_sigs_cosmic

#Calculate posterior based on COSMIC signatures 4, 11, 12, 15
cosmic_post = lda_posterior(bagel = bagel, signatures_to_use = c(12, 4, 11, 15))
#> [1] "Current Signature Proportions"
#> [1] 21.178614  7.990216  9.557200  8.230107
#> [1] 13.375901  3.392913  3.466201  3.099791
#> [1] 10.734148  2.311428  1.982983  1.839209
#> [1] 9.418194 1.888363 1.404390 1.345338
#> [1] 8.570813 1.666239 1.109379 1.093015
#> [1] 7.9039466 1.5205885 0.9300268 0.9395649
#> [1] 7.3965589 1.4204442 0.8127298 0.8403306
#> [1] 6.9960859 1.3465426 0.7301335 0.7720236
#> [1] 6.6704323 1.2890612 0.6685846 0.7228942
#> [1] 6.4880125 1.2550045 0.6250187 0.6915232
#> [1] 6.2625864 1.2171087 0.5865135 0.6640899
#> [1] 6.0629564 1.1841475 0.5544368 0.6423558
#> [1] 5.9730219 1.1672924 0.5308065 0.6294868
#> [1] 5.8154210 1.1419078 0.5074840 0.6152092
#> [1] 5.7563321 1.1305780 0.4902529 0.6074740
#> [1] 5.6221354 1.1094542 0.4723301 0.5969545
#> [1] 5.5821505 1.1015276 0.4592621 0.5919512
#> [1] 5.5499853 1.0950464 0.4479227 0.5880860
#> [1] 5.4384410 1.0780361 0.4353054 0.5805803
#> [1] 5.4151111 1.0731698 0.4263469 0.5777472
#> [1] 5.3966081 1.0692044 0.4185282 0.5755761
#> [1] 5.3814687 1.0659113 0.4116620 0.5738767
#> [1] 5.3688193 1.0631387 0.4056003 0.5725268
#> [1] 5.3580978 1.0607799 0.4002269 0.5714442
#> [1] 5.3489191 1.0587567 0.3954520 0.5705719
#> [1] 5.3410051 1.0570100 0.3912059 0.5698682
#> [1] 5.3341448 1.0554935 0.3874328 0.5693019
#> [1] 5.3281713 1.0541702 0.3840846 0.5688486
#> [1] 5.3229481 1.0530099 0.3811177 0.5684891
#> [1] 5.3183607 1.0519876 0.3784909 0.5682072
#> [1] 5.3143122 1.0510823 0.3761646 0.5679900
#> [1] 5.3107201 1.0502763 0.3741014 0.5678263
#> [1] 5.3075140 1.0495547 0.3722664 0.5677068
#> [1] 5.3046347 1.0489051 0.3706280 0.5676238
#> [1] 5.3020321 1.0483169 0.3691581 0.5675708
#> [1] 5.2996642 1.0477814 0.3678322 0.5675421
#> [1] 5.2974962 1.0472910 0.3666292 0.5675333
#> [1] 5.2954989 1.0468398 0.3655312 0.5675405
#> [1] 5.2936482 1.0464224 0.3645232 0.5675605
#> [1] 5.2919241 1.0460346 0.3635927 0.5675907
#> [1] 5.2903100 1.0456726 0.3627292 0.5676289
#> [1] 5.2887920 1.0453336 0.3619239 0.5676732
#> [1] 5.2873585 1.0450147 0.3611696 0.5677223
#> [1] 5.2859999 1.0447138 0.3604603 0.5677748
#> [1] 5.2847079 1.0444291 0.3597909 0.5678298
#> [1] 5.2834757 1.0441590 0.3591570 0.5678866
#> [1] 5.2822972 1.0439019 0.3585551 0.5679443
#> [1] 5.2811676 1.0436568 0.3579820 0.5680025
#> [1] 5.2800822 1.0434225 0.3574352 0.5680609
#> [1] 5.2790375 1.0431982 0.3569123 0.5681189
#> [1] 5.2780299 1.0429830 0.3564113 0.5681764
#> [1] 5.2770566 1.0427762 0.3559304 0.5682331
#> [1] 5.2761150 1.0425771 0.3554681 0.5682889
#> [1] 5.2752027 1.0423853 0.3550231 0.5683436
#> [1] 5.2743176 1.0422001 0.3545940 0.5683972
#> [1] 5.2734579 1.0420211 0.3541798 0.5684495
#> [1] 5.2726218 1.0418479 0.3537794 0.5685006
#> [1] 5.2718079 1.0416801 0.3533919 0.5685505
#> [1] 5.2710146 1.0415173 0.3530166 0.5685990
#> [1] 5.2702407 1.0413593 0.3526526 0.5686462
#> [1] 5.2694850 1.0412057 0.3522992 0.5686922
#> [1] 5.2687464 1.0410562 0.3519558 0.5687368
#> [1] 5.2680238 1.0409106 0.3516218 0.5687803
#> [1] 5.2673163 1.0407687 0.3512966 0.5688225
#> [1] 5.2666230 1.0406302 0.3509797 0.5688635
#> [1] 5.2659430 1.0404950 0.3506707 0.5689033
#> [1] 5.2652757 1.0403628 0.3503690 0.5689421
#> [1] 5.2646202 1.0402334 0.3500742 0.5689797
#> [1] 5.2639758 1.0401068 0.3497860 0.5690164
#> [1] 5.263342 1.039983 0.349504 0.569052
#> [1] 5.2627180 1.0398611 0.3492277 0.5690866
#> [1] 5.2621034 1.0397417 0.3489570 0.5691203
#> [1] 5.2614975 1.0396245 0.3486915 0.5691531
#> [1] 5.2608999 1.0395092 0.3484308 0.5691850
#> [1] 5.2603100 1.0393959 0.3481747 0.5692161
#> [1] 5.2597273 1.0392843 0.3479230 0.5692464
#> [1] 5.2591514 1.0391744 0.3476753 0.5692760
#> [1] 5.2585819 1.0390661 0.3474315 0.5693048
#> [1] 5.2580183 1.0389592 0.3471913 0.5693329
#> [1] 5.2574602 1.0388538 0.3469545 0.5693604
#> [1] 5.2569073 1.0387496 0.3467208 0.5693872
#> [1] 5.2563591 1.0386467 0.3464902 0.5694134
#> [1] 5.2558152 1.0385449 0.3462623 0.5694390
#> [1] 5.2552754 1.0384441 0.3460370 0.5694641
#> [1] 5.2547393 1.0383444 0.3458141 0.5694886
#> [1] 5.2542065 1.0382455 0.3455935 0.5695126
#> [1] 5.2536768 1.0381475 0.3453750 0.5695361
#> [1] 5.2531497 1.0380502 0.3451583 0.5695591
#> [1] 5.2526250 1.0379536 0.3449435 0.5695817
#> [1] 5.2521024 1.0378577 0.3447302 0.5696039
#> [1] 5.2515815 1.0377624 0.3445184 0.5696256
#> [1] 5.2510622 1.0376675 0.3443078 0.5696470
#> [1] 5.2505439 1.0375731 0.3440985 0.5696680
#> [1] 5.2500266 1.0374791 0.3438901 0.5696886
#> [1] 5.2495098 1.0373855 0.3436827 0.5697089
#> [1] 5.2489933 1.0372921 0.3434760 0.5697288
#> [1] 5.2484768 1.0371989 0.3432699 0.5697485
#> [1] 5.2479600 1.0371059 0.3430643 0.5697678
#> [1] 5.2474426 1.0370130 0.3428590 0.5697869
#> [1] 5.2469244 1.0369201 0.3426539 0.5698057

#Calculate posterior based on all calculated signatures
our_sigs_post = lda_posterior(bagel = bagel, signatures = result@signatures)
#> [1] "Current Signature Proportions"
#> [1] 1.777057 4.502511 4.969309 5.808680
#> [1] 0.4881618 1.5608790 1.8456957 2.4709678
#> [1] 0.2756002 0.9240493 1.1534770 1.6284886
#> [1] 0.1885935 0.6835168 0.8858405 1.2822737
#> [1] 0.1338143 0.5643380 0.7511794 1.1032498
#> [1] 0.09474708 0.49599585 0.67394062 0.99993134
#> [1] 0.06923104 0.43153169 0.58965080 0.86878540
#> [1] 0.05328232 0.40448149 0.56152483 0.83364421
#> [1] 0.04362156 0.38440192 0.54178287 0.81020283
#> [1] 0.03674622 0.36816939 0.52669435 0.79314897
#> [1] 0.03041712 0.41270236 0.63093029 1.01631813
#> [1] 0.02589758 0.40111331 0.62406495 1.01171922
#> [1] 0.0225344 0.3888533 0.6135826 0.9978439
#> [1] 0.01993572 0.37846685 0.60454697 0.98576720
#> [1] 0.01786865 0.36998728 0.59692562 0.97560489
#> [1] 0.01618603 0.36320697 0.59058190 0.96720619
#> [1] 0.01479031 0.35774181 0.58531293 0.96025421
#> [1] 0.01361424 0.35318222 0.58090367 0.95439444
#> [1] 0.01260996 0.34919288 0.57716390 0.94932083
#> [1] 0.01174254 0.34553318 0.57393805 0.94479807
#> [1] 0.01098586 0.34203913 0.57110138 0.94065160
#> [1] 0.01032003 0.33860064 0.56855381 0.93675220
#> [1] 0.009729648 0.335146549 0.566215645 0.933005504
#> [1] 0.009202584 0.331639526 0.564026276 0.929348488
#> [1] 0.00872918 0.32807887 0.56194531 0.92575203
#> [1] 0.008301647 0.324507265 0.559955248 0.922226560
#> [1] 0.007913641 0.321014114 0.558062999 0.918825089
#> [1] 0.007559943 0.317725267 0.556296595 0.915635409
#> [1] 0.007236228 0.314773614 0.554694350 0.912756510
#> [1] 0.006938872 0.312259462 0.553289273 0.910265942
#> [1] 0.006664818 0.310222503 0.552096571 0.908195582
#> [1] 0.00641146 0.30864071 0.55111054 0.90652868
#> [1] 0.006176565 0.307450935 0.550309884 0.905214842
#> [1] 0.005958206 0.306574572 0.549666014 0.904189950
#> [1] 0.005754708 0.305936141 0.549149648 0.903391137
#> [1] 0.005564616 0.305472310 0.548734546 0.902764430
#> [1] 0.005386653 0.305133989 0.548398850 0.902266889
#> [1] 0.0052197 0.3048849 0.5481251 0.9018658
#> [1] 0.005062769 0.304699069 0.547899597 0.901537028
#> [1] 0.004914987 0.304558083 0.547711836 0.901262675
#> [1] 0.004775577 0.304449099 0.547553688 0.901029794
#> [1] 0.004643849 0.304363133 0.547418917 0.900828886
#> [1] 0.004519186 0.304293897 0.547302720 0.900652961
#> [1] 0.004401036 0.304236969 0.547201387 0.900496839
#> [1] 0.004288902 0.304189219 0.547112041 0.900356639
#> [1] 0.004182335 0.304148409 0.547032443 0.900229430
#> [1] 0.004080932 0.304112929 0.546960839 0.900112966
#> [1] 0.003984326 0.304081604 0.546895851 0.900005513
#> [1] 0.003892186 0.304053570 0.546836390 0.899905715
#> [1] 0.003804208 0.304028184 0.546781590 0.899812499
#> [1] 0.003720117 0.304004962 0.546730761 0.899725007
#> [1] 0.003639661 0.303983535 0.546683347 0.899642545
#> [1] 0.00356261 0.30396362 0.54663890 0.89956455
#> [1] 0.003488752 0.303944990 0.546597045 0.899490546
#> [1] 0.003417892 0.303927477 0.546557490 0.899420150
#> [1] 0.003349852 0.303910939 0.546519984 0.899353029
#> [1] 0.003284467 0.303895263 0.546484319 0.899288904
#> [1] 0.003221585 0.303880357 0.546450321 0.899227534
#> [1] 0.003161063 0.303866146 0.546417842 0.899168708
#> [1] 0.003102773 0.303852566 0.546386755 0.899112245
#> [1] 0.003046592 0.303839563 0.546356952 0.899057982
#> [1] 0.002992409 0.303827091 0.546328337 0.899005777
#> [1] 0.002940119 0.303815111 0.546300828 0.898955501
#> [1] 0.002889624 0.303803587 0.546274350 0.898907038
#> [1] 0.002840834 0.303792490 0.546248839 0.898860283
#> [1] 0.002793663 0.303781793 0.546224236 0.898815141
#> [1] 0.002748032 0.303771470 0.546200484 0.898771516
#> [1] 0.002703899 0.304121120 0.547190599 0.900964881
#> [1] 0.00266106 0.30300056 0.54391495 0.89365205
#> [1] 0.002619749 0.305151053 0.550334312 0.908078425
#> [1] 0.002579851 0.307387899 0.556015329 0.920207161
#> [1] 0.002541093 0.307190040 0.554426222 0.915807361
#> [1] 0.002503347 0.305533517 0.549476931 0.904427263
#> [1] 0.002466706 0.305315055 0.549356863 0.904324238
#> [1] 0.002430981 0.303187980 0.543639360 0.891861507
#> [1] 0.00239618 0.30136577 0.53937560 0.88311987
#> [1] 0.002362323 0.300297664 0.537319763 0.879446426
#> [1] 0.00232951 0.30141295 0.54114630 0.88865530
#> [1] 0.002297788 0.304483937 0.549635143 0.907602515
#> [1] 0.002266732 0.302041045 0.541565440 0.889079704
#> [1] 0.002236455 0.300972898 0.539025214 0.883787372
#> [1] 0.00220718 0.30418720 0.54860743 0.90539441
#> [1] 0.002178701 0.305369221 0.550957773 0.909968006
#> [1] 0.002150687 0.301079192 0.538150907 0.881072491
#> [1] 0.00212352 0.30292792 0.54459007 0.89602213
#> [1] 0.002097048 0.303380256 0.545640437 0.898263748
#> [1] 0.002071186 0.302670226 0.543406012 0.893177951
#> [1] 0.002045941 0.302335465 0.542636618 0.891590498
#> [1] 0.002021345 0.303069489 0.544878938 0.896687238
#> [1] 0.001997275 0.301962264 0.541564011 0.889265310
#> [1] 0.001973814 0.302689297 0.543931450 0.894728128
#> [1] 0.001951057 0.306271230 0.553903908 0.916736820
#> [1] 0.001928866 0.308049185 0.557589283 0.923866294
#> [1] 0.001907026 0.305205172 0.548468023 0.902605966
#> [1] 0.001885807 0.308070937 0.557203088 0.922057599
#> [1] 0.001864935 0.305570695 0.549362647 0.903979502
#> [1] 0.001844674 0.309147924 0.560110830 0.927981858
#> [1] 0.001824617 0.303790515 0.543978310 0.891520957
#> [1] 0.001804945 0.301858719 0.540076675 0.883864303
#> [1] 0.001785934 0.307572424 0.557447111 0.923220547

#Plot results from posterior calculation
MotifSig::plot_signatures(cosmic_post)
```

![plot of chunk unnamed-chunk-2](figure/unnamed-chunk-2-5.png)

```r
MotifSig::plot_samples(cosmic_post, proportional = TRUE)
```

![plot of chunk unnamed-chunk-2](figure/unnamed-chunk-2-6.png)

```r

MotifSig::plot_signatures(our_sigs_post)
```

![plot of chunk unnamed-chunk-2](figure/unnamed-chunk-2-7.png)

```r
MotifSig::plot_samples(our_sigs_post, proportional = TRUE)
```

![plot of chunk unnamed-chunk-2](figure/unnamed-chunk-2-8.png)

```r

#Compare posterior results to each other
MotifSig::compare_results(cosmic_post, our_sigs_post, threshold = 0.60)
```

![plot of chunk unnamed-chunk-2](figure/unnamed-chunk-2-9.png)

```
#>         cor xindex yindex        xcol        ycol
#> 1 0.8465479      2      4 Signature.4 Signature.4

plot_sample(bagel, sample_names(bagel)[1])
```

![plot of chunk unnamed-chunk-2](figure/unnamed-chunk-2-10.png)

```r
#make kerning better (no spaces)
```
